<!-- save as index.html and open locally or host to GitHub Pages / Netlify -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DreamPop Therapy — Starter</title>
  <style>
    :root{
      --bg:#0b0920; --ui:#ffffffcc; --accent:#8b7cff;
    }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;}
    #game-container{width:100%;height:100vh;display:flex;flex-direction:column;}
    #topbar{display:flex;gap:8px;align-items:center;padding:8px;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);color:var(--ui);}
    .btn{background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.06);padding:6px 10px;border-radius:10px;color:var(--ui);cursor:pointer}
    .small{font-size:13px;padding:4px 8px;border-radius:8px}
    #hud{margin-left:auto;display:flex;gap:8px;align-items:center}
    #custom-panel{position:fixed;right:12px;top:72px;background:rgba(0,0,0,0.5);padding:12px;border-radius:12px;color:var(--ui);backdrop-filter:blur(6px);}
    label{display:block;font-size:12px;margin-bottom:6px}
    input[type=color]{width:48px;height:34px;padding:0;border:0;background:none;cursor:pointer}
    #daily-timer{font-weight:600}
    #credits{position:fixed;left:12px;bottom:12px;color:rgba(255,255,255,0.5);font-size:12px}
    /* simple mobile-friendly */
    @media (max-width:600px){#topbar{padding:6px;font-size:13px}}
  </style>
  <!-- Phaser 3 CDN -->
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
  <!-- Firebase optional (comment out if unused) -->
  <!-- <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script> -->
</head>
<body>
  <div id="game-container">
    <div id="topbar">
      <div style="display:flex;gap:8px;align-items:center">
        <div style="font-weight:700;font-size:16px">DreamPop Therapy</div>
        <div style="opacity:0.8;font-size:13px">— calm, pop, transform</div>
      </div>
      <div id="hud">
        <button id="dailyBtn" class="btn small">Daily Calm (5m)</button>
        <div id="daily-timer">00:00</div>
        <button id="customBtn" class="btn small">Customize</button>
        <button id="saveBtn" class="btn small">Save</button>
      </div>
    </div>

    <div id="phaser-root" style="flex:1"></div>

    <div id="custom-panel" style="display:none">
      <label>Bubble Color</label>
      <input id="colorPicker" type="color" value="#8b7cff"/>
      <label style="margin-top:8px">Background Hue</label>
      <input id="bgPicker" type="color" value="#0b0920"/>
      <div style="margin-top:10px;display:flex;gap:6px">
        <button id="applyCustom" class="btn small">Apply</button>
        <button id="resetCustom" class="btn small">Reset</button>
      </div>
    </div>

    <div id="credits">Starter • Phaser.js • Firebase optional • Add AdSense/PayPal in header/footer</div>
  </div>

  <script>
  /**************************************************************************
   * DreamPop Therapy — Phaser 3 Starter
   * Features:
   * - Floating "stress bubbles" that drift and are popped on click/tap
   * - Particle/light + sound on pop
   * - Daily Calm 5-minute mode with a simple timer
   * - Customization UI (bubble & bg colors)
   * - Firebase hooks (placeholders) for saving progress / unlocked rewards
   * - Placeholders for AdSense / PayPal (comments below)
   *
   * How to use:
   * 1) Optionally uncomment Firebase <script> tags above and fill firebaseConfig below.
   * 2) Host assets (sounds/images) or use inline shapes (this starter uses shapes).
   * 3) Deploy to GitHub Pages or Netlify.
   **************************************************************************/

  // ----- Minimal sound generation fallback (WebAudio) -----
  function beep(freq = 440, duration = 0.06) {
    try {
      const ctx = window.__dp_audio_ctx || (window.__dp_audio_ctx = new (window.AudioContext || window.webkitAudioContext)());
      const o = ctx.createOscillator();
      const g = ctx.createGain();
      o.type = 'sine'; o.frequency.value = freq;
      g.gain.value = 0.02;
      o.connect(g); g.connect(ctx.destination);
      o.start();
      g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + duration);
      setTimeout(()=>{ o.stop(); o.disconnect(); g.disconnect(); }, duration*1000 + 50);
    } catch (e) {}
  }

  // ----- Phaser Game -----
  const config = {
    type: Phaser.AUTO,
    parent: 'phaser-root',
    width: window.innerWidth,
    height: window.innerHeight - document.getElementById('topbar').offsetHeight,
    backgroundColor: getComputedStyle(document.documentElement).getPropertyValue('--bg') || '#0b0920',
    scene: {
      preload: preload,
      create: create,
      update: update
    },
    scale: { mode: Phaser.Scale.RESIZE, autoCenter: Phaser.Scale.CENTER_BOTH }
  };

  const game = new Phaser.Game(config);

  let bubbles, particles, popSound;
  let bubbleColor = '#8b7cff', bgColor = '#0b0920';
  let isDailyMode = false, dailyEnd = 0, dailyInterval;
  let unlocks = {quotes:0, sounds:0, art:0}; // simple rewards counters

  function preload() {
    // we use simple generated textures — no external assets required
  }

  function create() {
    const scene = this;

    // particle emitter (glow effect)
    const gfx = this.add.graphics();
    gfx.fillStyle(0xffffff, 1);
    gfx.fillCircle(8,8,8);
    gfx.generateTexture('particle', 16, 16);
    gfx.destroy();

    particles = this.add.particles('particle');

    bubbles = this.add.group();

    // spawn routine
    this.time.addEvent({
      delay: 900,
      callback: () => spawnBubble(scene),
      loop: true
    });

    // input handler for popping
    this.input.on('pointerdown', (pointer) => {
      const x = pointer.worldX, y = pointer.worldY;
      // check topmost bubble under pointer
      const hit = bubbles.getChildren().slice().reverse().find(b => Phaser.Geom.Circle.Contains(b.bodyCircle, x, y));
      if (hit) popBubble(scene, hit);
    });

    // create ambient slow animation background using gradient rectangle
    const bg = this.add.rectangle(0,0,scene.scale.width, scene.scale.height, Phaser.Display.Color.HexStringToColor(bgColor).color, 1).setOrigin(0);
    bg.setDepth(-2);
    scene.scale.on('resize', (gameSize) => { bg.setSize(gameSize.width, gameSize.height); });

    // HUD updates from DOM (timer etc) wired outside
    updateBackgroundColor();

    // light ambient beep occasionally
    this.time.addEvent({ delay: 8000, callback: ()=>beep(300,0.04), loop: true });
  }

  function update(time, dt) {
    // gently rotate and fade bubbles; remove offscreen / tiny ones
    Phaser.Actions.Call(bubbles.getChildren(), function(b){
      b.y -= b.speed * dt/1000;
      b.x += Math.sin((time + b.seed)/800) * 0.2;
      b.alpha = Phaser.Math.Clamp(b.alpha - 0.0006 * dt/16, 0.25, 1);
      if (b.y < -80 || b.alpha <= 0.26) { b.destroy(); }
      b.bodyCircle.setTo(b.x, b.y, b.radius);
    });
  }

  function spawnBubble(scene) {
    const w = scene.scale.width, h = scene.scale.height;
    const radius = Phaser.Math.Between(22, 60);
    const x = Phaser.Math.Between(radius, w - radius);
    const y = h + radius + Phaser.Math.Between(0, 120);

    // create a circle graphics and texture on the fly
    const key = 'b-' + Math.round(radius) + '-' + bubbleColor;
    if (!scene.textures.exists(key)) {
      const g = scene.add.graphics();
      const color = Phaser.Display.Color.HexStringToColor(bubbleColor).color;
      g.fillStyle(color, 0.12);
      g.fillCircle(radius, radius, radius);
      g.lineStyle(2, Phaser.Display.Color.HexStringToColor(bubbleColor).color, 0.28);
      g.strokeCircle(radius, radius, radius);
      g.generateTexture(key, radius*2, radius*2);
      g.destroy();
    }

    const s = scene.add.image(x,y,key).setInteractive({useHandCursor:true});
    s.setOrigin(0.5);
    s.radius = radius;
    s.speed = Phaser.Math.FloatBetween(10, 45) * (radius/50);
    s.seed = Phaser.Math.Between(0,10000);
    s.alpha = 1;
    s.bodyCircle = new Phaser.Geom.Circle(x,y,radius);
    bubbles.add(s);
  }

  function popBubble(scene, bubble) {
    // particles burst
    particles.createEmitter({
      x: bubble.x, y: bubble.y, speed: { min: -100, max: 100 }, lifespan: { min: 500, max: 1200 },
      quantity: 18, scale: { start: 0.8, end: 0 }, blendMode: 'ADD'
    }).explode(18, bubble.x, bubble.y);

    // gentle sound
    beep(540 - bubble.radius*2, 0.08);

    // transform: animate glow expanding (simple tween)
    const glow = scene.add.circle(bubble.x, bubble.y, bubble.radius*0.6, Phaser.Display.Color.HexStringToColor(bubbleColor).color);
    glow.setAlpha(0.35);
    scene.tweens.add({ targets: glow, scale: 3.5, alpha: 0, duration: 700, ease: 'Cubic.easeOut', onComplete: ()=>glow.destroy() });

    // incremental reward logic (simple)
    unlocks.quotes += 1;
    // pop visual and destroy
    bubble.destroy();

    // optional: small haptic on devices (if supported)
    if (navigator.vibrate) navigator.vibrate(20);

    // show small achievement popup (DOM)
    showTempNote("+calm", bubble.x, bubble.y);
  }

  function showTempNote(text, x, y) {
    const el = document.createElement('div');
    el.textContent = text;
    el.style.position = 'fixed';
    el.style.left = `${Math.max(8, Math.min(window.innerWidth-80, x))}px`;
    el.style.top = `${Math.max(64, Math.min(window.innerHeight-24, y))}px`;
    el.style.padding = '6px 8px';
    el.style.borderRadius = '8px';
    el.style.background = 'rgba(255,255,255,0.06)';
    el.style.color = 'white';
    el.style.fontSize = '13px';
    el.style.pointerEvents = 'none';
    document.body.appendChild(el);
    setTimeout(()=>el.style.opacity='0', 900);
    setTimeout(()=>el.remove(), 1400);
  }

  // ----- Daily Calm (5-minute) -----
  document.getElementById('dailyBtn').addEventListener('click', () => {
    if (isDailyMode) stopDaily();
    else startDaily();
  });

  function startDaily() {
    isDailyMode = true;
    const now = Date.now();
    dailyEnd = now + 5*60*1000; // 5 minutes
    document.getElementById('dailyBtn').textContent = 'End Calm';
    updateDailyTimer();
    dailyInterval = setInterval(updateDailyTimer, 200);
    // gentle scene effect: spawn fewer larger bubbles
    // (we could adjust spawn frequency — for demo we'll just notify)
    showTempNote("Daily Calm — 5:00", window.innerWidth/2, 120);
  }

  function stopDaily() {
    isDailyMode = false;
    clearInterval(dailyInterval);
    document.getElementById('dailyBtn').textContent = 'Daily Calm (5m)';
    document.getElementById('daily-timer').textContent = '00:00';
  }

  function updateDailyTimer() {
    const remaining = Math.max(0, dailyEnd - Date.now());
    const mm = String(Math.floor(remaining/60000)).padStart(2,'0');
    const ss = String(Math.floor((remaining%60000)/1000)).padStart(2,'0');
    document.getElementById('daily-timer').textContent = `${mm}:${ss}`;
    if (remaining <= 0) { stopDaily(); unlockDailyReward(); }
  }

  function unlockDailyReward() {
    // unlock calm quote / sound
    unlocks.sounds += 1;
    showTempNote("Daily complete — quote unlocked", window.innerWidth/2, 140);
    // For real: add to Firebase / localStorage
  }

  // ----- Customization panel -----
  document.getElementById('customBtn').addEventListener('click', () => {
    const p = document.getElementById('custom-panel');
    p.style.display = (p.style.display === 'none' || p.style.display === '') ? 'block' : 'none';
  });
  document.getElementById('applyCustom').addEventListener('click', () => {
    bubbleColor = document.getElementById('colorPicker').value;
    bgColor = document.getElementById('bgPicker').value;
    updateBackgroundColor();
  });
  document.getElementById('resetCustom').addEventListener('click', () => {
    bubbleColor = '#8b7cff'; bgColor = '#0b0920';
    document.getElementById('colorPicker').value = bubbleColor;
    document.getElementById('bgPicker').value = bgColor;
    updateBackgroundColor();
  });

  function updateBackgroundColor() {
    document.documentElement.style.setProperty('--bg', bgColor);
    document.body.style.background = `linear-gradient(180deg, ${bgColor}, #000000)`;
    // Update phaser background if game exists
    if (game && game.config) {
      game.renderer.backgroundColor = Phaser.Display.Color.HexStringToColor(bgColor).color;
    }
  }

  // ----- Save (Firebase/localStorage hook) -----
  document.getElementById('saveBtn').addEventListener('click', () => {
    // Save to localStorage as fallback
    const state = { unlocked: unlocks, bubbleColor, bgColor, savedAt: new Date().toISOString() };
    try { localStorage.setItem('dreampop_state', JSON.stringify(state)); showTempNote("Saved locally", 120, window.innerHeight - 120); }
    catch(e){ showTempNote("Save failed", 120, window.innerHeight - 120); }

    // TODO: If Firebase configured, push to database:
    // firebase.database().ref('users/' + uid + '/state').set(state)
  });

  // Optional: load saved state
  (function loadSaved(){
    try{
      const s = localStorage.getItem('dreampop_state');
      if (s) {
        const st = JSON.parse(s);
        if (st.bubbleColor) bubbleColor = st.bubbleColor;
        if (st.bgColor) bgColor = st.bgColor;
        unlocks = st.unlocked || unlocks;
        document.getElementById('colorPicker').value = bubbleColor;
        document.getElementById('bgPicker').value = bgColor;
        updateBackgroundColor();
      }
    }catch(e){}
  })();

  // ----- Responsive resize hook to keep canvas correct -----
  window.addEventListener('resize', ()=> {
    game.scale.resize(window.innerWidth, window.innerHeight - document.getElementById('topbar').offsetHeight);
  });

  // ----- Firebase placeholder (uncomment and fill your config if using) -----
  /*
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_AUTHDOMAIN",
    databaseURL: "YOUR_DB_URL",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_BUCKET",
    messagingSenderId: "SENDER_ID",
    appId: "APP_ID"
  };
  // Initialize:
  firebase.initializeApp(firebaseConfig);
  // Example: save state to user id after auth
  */

  // ----- Monetization placeholders -----
  // Google AdSense: add script in <head> and ad container where desired.
  // Example (replace with your AdSense client ID):
  // <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=YOUR_CLIENT_ID" crossorigin="anonymous"></script>
  // Then an ad slot: <ins class="adsbygoogle" style="display:block" data-ad-client="..." data-ad-slot="..." data-ad-format="auto"></ins>

  // PayPal / Donations: add a button in DOM; for simple checkout & donations you can use PayPal Smart Buttons script.
  // Stripe: use client+server; Stripe Checkout or Payment Links can be used to avoid backend.

  // Premium content hook: keep a "premium" flag on saved state; when user has premium, unlock skin/packs in UI.

  </script>
</body>
</html>
